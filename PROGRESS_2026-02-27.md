# üìã Progress Log ‚Äî 2026-02-27

## üéØ Session Goals
Fix recurring "No Answer Found" bug and polish the UI for presentation readiness.

---

## ‚úÖ Changes Made

### 1. Critical Fix: Similarity Threshold ‚Äî `config/settings.py`
- **Bug:** `MIN_SIMILARITY_THRESHOLD = 0.2` but real FAISS inner-product scores for uploaded PDFs are only ~0.05‚Äì0.15
- **Impact:** Every query returned "No Answer Found" with 0.0% confidence ‚Äî ALL results were filtered out before reaching the LLM
- **Fix:** Lowered threshold from `0.2` ‚Üí `0.03`
- **Diagnostic method:** Wrote a script to dump raw FAISS scores for multiple queries, confirming scores range 0.06‚Äì0.14

### 2. Backend Cleanup ‚Äî `backend/app.py`
- Removed the `_check_confidence` monkey-patch (workaround from a previous session now unnecessary since the root cause is fixed)

### 3. Confidence Display Rescaled ‚Äî `frontend/src/App.jsx`
- **Before:** Showed "Confidence: 15.0%" in a RED badge (thresholds: high‚â•70%, medium‚â•40%) ‚Äî looked like failure
- **After:** Shows **"Strong match"** in GREEN (thresholds rescaled: high‚â•12%, medium‚â•6% to match FAISS score range)
- Added semantic labels: "Strong match", "Moderate match", "Weak match"

### 4. Loading Animation ‚Äî `frontend/src/App.jsx` + `index.css`
- Added **progressive loading messages** that cycle every 8s:
  1. "Searching knowledge base‚Ä¶"
  2. "Analyzing relevant chunks‚Ä¶"
  3. "Generating answer with AI‚Ä¶"
  4. "Almost there ‚Äî finalizing response‚Ä¶"
- Added an **animated progress bar** with sliding gradient fill
- Prevents users from thinking the app is frozen during the 30-60s LLM wait

### 5. Collapsible Source Cards ‚Äî `frontend/src/App.jsx` + `index.css`
- Sources now **collapsed by default** with a toggle: "‚ñ∂ 3 sources retrieved"
- Click to expand with smooth slide-down animation and rotating chevron
- Per-message state tracking (each answer remembers its own toggle state)
- Keeps the chat clean while sources are one click away

### 6. Branding ‚Äî `frontend/index.html` + `public/favicon.svg`
- Custom SVG favicon: branded "R" on blue gradient background
- Page title: "RAG Assistant ‚Äî Document Q&A"
- Meta description for SEO

---

## üêõ Bugs Fixed Summary

| # | Bug | File | Status |
|---|-----|------|--------|
| 1 | ALL queries returned "No Answer Found" (threshold too high) | `config/settings.py` | ‚úÖ Fixed |
| 2 | Stale monkey-patch overriding confidence check | `backend/app.py` | ‚úÖ Removed |
| 3 | Confidence badge always showed red (misleading) | `frontend/src/App.jsx` | ‚úÖ Fixed |

---

## üìÅ Files Modified Today

| File | Change |
|------|--------|
| `config/settings.py` | Threshold 0.2 ‚Üí 0.03 |
| `backend/app.py` | Removed monkey-patch of `_check_confidence` |
| `frontend/src/App.jsx` | Rescaled confidence, loading animation, collapsible sources |
| `frontend/src/index.css` | Styles for loading bar, sources toggle, animations |
| `frontend/index.html` | Branded title, favicon, meta description |
| `frontend/public/favicon.svg` | **[NEW]** Custom SVG favicon |

---

## üîß System State

- **LLM:** `phi3:mini` via Ollama (local, CPU)
- **Embeddings:** `sentence-transformers/all-MiniLM-L6-v2`
- **Vector Store:** FAISS (IndexFlatIP, cosine similarity)
- **Backend:** FastAPI on `http://localhost:8000`
- **Frontend:** React + Vite on `http://localhost:5173`
- **Similarity Threshold:** 0.03 (was 0.2)

---

## üöÄ Next Steps

- [ ] Test with a wide variety of PDF documents
- [ ] Consider integrating a cloud LLM API (Groq / Gemini) as a future enhancement
- [ ] Add drag-and-drop PDF upload
- [ ] Further UI suggestions from previous session (UI review)
